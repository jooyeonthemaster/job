# ğŸš€ Firebase â†’ Supabase ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰ ê°€ì´ë“œ

## ğŸ“‹ í˜„ì¬ ì™„ë£Œëœ ì‘ì—…

âœ… í™˜ê²½ ë³€ìˆ˜ ì„¤ì • (`@env.txt`)  
âœ… Supabase í´ë¼ì´ì–¸íŠ¸ ì„¤ì • (`lib/supabase/config.ts`)  
âœ… PostgreSQL ìŠ¤í‚¤ë§ˆ ì‘ì„± (`supabase/schema.sql`)  
âœ… ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„± (`scripts/migrate-firebase-to-supabase.ts`)  
âœ… `@supabase/supabase-js` íŒ¨í‚¤ì§€ ì„¤ì¹˜ ì™„ë£Œ

---

## ğŸ¯ ë‹¤ìŒ ë‹¨ê³„ (ìˆœì„œëŒ€ë¡œ ì§„í–‰)

### Step 1: Supabase Service Role Key íšë“

1. Supabase Dashboard ì ‘ì†: https://kzovapvythsgskklmukj.supabase.co
2. **Settings** > **API** ë©”ë‰´ë¡œ ì´ë™
3. **Service Role Key** ë³µì‚¬ (âš ï¸ ì ˆëŒ€ ê³µê°œí•˜ì§€ ë§ˆì„¸ìš”!)
4. `.env.local` íŒŒì¼ì— ì¶”ê°€:

```bash
SUPABASE_SERVICE_ROLE_KEY="ì—¬ê¸°ì—_Service_Role_Key_ë¶™ì—¬ë„£ê¸°"
```

> âš ï¸ **ì¤‘ìš”**: Service Role KeyëŠ” `.env.local`ì—ë§Œ ì €ì¥í•˜ê³ , ì ˆëŒ€ Gitì— ì»¤ë°‹í•˜ì§€ ë§ˆì„¸ìš”!

---

### Step 2: Supabaseì—ì„œ ìŠ¤í‚¤ë§ˆ ìƒì„±

1. Supabase Dashboard > **SQL Editor** ë©”ë‰´ë¡œ ì´ë™
2. "New Query" í´ë¦­
3. `supabase/schema.sql` íŒŒì¼ì˜ ë‚´ìš©ì„ ì „ì²´ ë³µì‚¬
4. SQL Editorì— ë¶™ì—¬ë„£ê¸°
5. **"Run"** ë²„íŠ¼ í´ë¦­í•˜ì—¬ ì‹¤í–‰

**ì˜ˆìƒ ê²°ê³¼**:
- 17ê°œì˜ í…Œì´ë¸” ìƒì„±
- 40ê°œ ì´ìƒì˜ ì¸ë±ìŠ¤ ìƒì„±
- RLS ì •ì±… ì ìš©
- 2ê°œì˜ VIEW ìƒì„±

**í™•ì¸ ë°©ë²•**:
```sql
-- í…Œì´ë¸” ëª©ë¡ í™•ì¸
SELECT tablename FROM pg_tables 
WHERE schemaname = 'public' 
ORDER BY tablename;
```

---

### Step 3: ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰

#### 3-1. í•„ìˆ˜ íŒ¨í‚¤ì§€ ì„¤ì¹˜

```bash
npm install --save-dev dotenv ts-node @types/node
```

#### 3-2. ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰

```bash
npx ts-node scripts/migrate-firebase-to-supabase.ts
```

**ì˜ˆìƒ ì†Œìš” ì‹œê°„**:
- 100ëª… ì‚¬ìš©ì: ~30ì´ˆ
- 1,000ëª… ì‚¬ìš©ì: ~5ë¶„
- 10,000ëª… ì‚¬ìš©ì: ~30ë¶„

**ì‹¤í–‰ í™”ë©´ ì˜ˆì‹œ**:
```
ğŸš€ Firebase â†’ Supabase ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹œì‘

âš ï¸  ì£¼ì˜: ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!
âš ï¸  Supabaseì—ì„œ schema.sqlì„ ë¨¼ì € ì‹¤í–‰í–ˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”!

ğŸ”„ Users ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹œì‘...
ğŸ“Š ì´ 150ëª…ì˜ ì‚¬ìš©ì ë°œê²¬
âœ… User 1/150: í™ê¸¸ë™
âœ… User 2/150: ê¹€ì² ìˆ˜
...
âœ… Users ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ: 150/150 ì„±ê³µ

ğŸ”„ Companies ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹œì‘...
...
```

---

### Step 4: ë°ì´í„° ê²€ì¦

Supabase Dashboard > **Table Editor**ì—ì„œ ê° í…Œì´ë¸” í™•ì¸:

#### í•„ìˆ˜ ê²€ì¦ í•­ëª©

- [ ] `users` í…Œì´ë¸”ì— ë°ì´í„° ì¡´ì¬
- [ ] `companies` í…Œì´ë¸”ì— ë°ì´í„° ì¡´ì¬  
- [ ] `jobs` í…Œì´ë¸”ì— ë°ì´í„° ì¡´ì¬
- [ ] `user_skills`, `user_experiences` ë“± ê´€ê³„ í…Œì´ë¸”ì— ë°ì´í„° ì¡´ì¬
- [ ] `companies_with_job_count` VIEW ì‘ë™ í™•ì¸

**VIEW í…ŒìŠ¤íŠ¸ ì¿¼ë¦¬**:
```sql
-- N+1 ë¬¸ì œê°€ í•´ê²°ëœ ì¿¼ë¦¬ í…ŒìŠ¤íŠ¸
SELECT * FROM companies_with_job_count LIMIT 10;
```

---

### Step 5: ì„œë¹„ìŠ¤ ë ˆì´ì–´ ì½”ë“œ ë³€í™˜

ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‘ì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì£¼ìš” íŒŒì¼:

- `lib/supabase/auth-service.ts` - ì¸ì¦ ì„œë¹„ìŠ¤
- `lib/supabase/company-service.ts` - ê¸°ì—… ì„œë¹„ìŠ¤
- `lib/supabase/jobseeker-service.ts` - êµ¬ì§ì ì„œë¹„ìŠ¤
- `lib/supabase/job-service.ts` - ì±„ìš©ê³µê³  ì„œë¹„ìŠ¤
- `lib/supabase/application-service.ts` - ì§€ì›/ì‹ ì²­ ì„œë¹„ìŠ¤

---

### Step 6: ì ì§„ì  ì „í™˜ (ê¶Œì¥)

#### Option A: ì™„ì „ ì „í™˜ (ë¹ ë¥´ì§€ë§Œ ìœ„í—˜)
- ëª¨ë“  Firebase ì½”ë“œë¥¼ Supabaseë¡œ í•œ ë²ˆì— êµì²´
- í…ŒìŠ¤íŠ¸ í›„ ë°”ë¡œ ë°°í¬
- âš ï¸ ë¬¸ì œ ë°œìƒ ì‹œ ë¡¤ë°± ì–´ë ¤ì›€

#### Option B: ì ì§„ì  ì „í™˜ (ì•ˆì „)
- ì½ê¸° ì‘ì—…ë¶€í„° Supabaseë¡œ ì „í™˜
- FirebaseëŠ” ì“°ê¸° ì‘ì—…ë§Œ ìœ ì§€
- ë¬¸ì œì—†ìœ¼ë©´ ì“°ê¸° ì‘ì—…ë„ ì „í™˜
- âœ… ê¶Œì¥ ë°©ì‹

---

## ğŸ”§ ë¬¸ì œ í•´ê²°

### 1. "SUPABASE_SERVICE_ROLE_KEYê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤" ì˜¤ë¥˜

**í•´ê²°**:
- `.env.local` íŒŒì¼ì— Service Role Key ì¶”ê°€
- íŒŒì¼ ê²½ë¡œ í™•ì¸: í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— `.env.local` ì¡´ì¬í•´ì•¼ í•¨

### 2. "relation does not exist" ì˜¤ë¥˜

**í•´ê²°**:
- Supabase SQL Editorì—ì„œ `schema.sql` ë¨¼ì € ì‹¤í–‰
- ëª¨ë“  SQLì´ ì„±ê³µì ìœ¼ë¡œ ì‹¤í–‰ë˜ì—ˆëŠ”ì§€ í™•ì¸

### 3. "violates foreign key constraint" ì˜¤ë¥˜

**í•´ê²°**:
- ë§ˆì´ê·¸ë ˆì´ì…˜ ìˆœì„œ í™•ì¸ (users â†’ companies â†’ jobs â†’ applications)
- ID ë§¤í•‘ì´ ì œëŒ€ë¡œ ë˜ì—ˆëŠ”ì§€ í™•ì¸

### 4. ë§ˆì´ê·¸ë ˆì´ì…˜ì´ ì¤‘ê°„ì— ë©ˆì¶¤

**í•´ê²°**:
- ë„¤íŠ¸ì›Œí¬ ì—°ê²° í™•ì¸
- Supabase í”„ë¡œì íŠ¸ ìƒíƒœ í™•ì¸ (paused ì—¬ë¶€)
- ìŠ¤í¬ë¦½íŠ¸ ì¬ì‹¤í–‰ (ì¤‘ë³µ ì‚½ì… ë°©ì§€ ë¡œì§ ìˆìŒ)

---

## ğŸ“Š ë§ˆì´ê·¸ë ˆì´ì…˜ ì „í›„ ë¹„êµ

### ì¿¼ë¦¬ ì„±ëŠ¥ ë¹„êµ

| ì‘ì—… | Firebase | Supabase | ê°œì„ ìœ¨ |
|------|---------|---------|--------|
| ê¸°ì—… ëª©ë¡ + ê³µê³  ìˆ˜ (100ê°œ) | 101ë²ˆ ì¿¼ë¦¬, ~10ì´ˆ | 1ë²ˆ ì¿¼ë¦¬, ~0.5ì´ˆ | ğŸ”¥ 95% |
| ì¸ì¬í’€ ì¡°íšŒ (1,000ëª…) | 1,000 reads, ~2ì´ˆ | í•„í„°ë§ ì¿¼ë¦¬, ~0.2ì´ˆ | ğŸ”¥ 90% |
| ê³µê³  ê²€ìƒ‰ (í•„í„° 3ê°œ) | ì „ì²´ ì¡°íšŒ í›„ í•„í„°ë§ | WHERE + INDEX í™œìš© | ğŸ”¥ 80% |

### ë¹„ìš© ë¹„êµ (ì›” 10,000ëª… ì‚¬ìš©ì ê¸°ì¤€)

| í•­ëª© | Firebase | Supabase | ì ˆê°ì•¡ |
|------|---------|---------|--------|
| ì½ê¸° ë¹„ìš© | ~30M reads = $180 | ë¬´ì œí•œ = $0 | $180 |
| ì“°ê¸° ë¹„ìš© | ~5M writes = $9 | ë¬´ì œí•œ = $0 | $9 |
| DB ë¹„ìš© | $0 | $25 (Pro) | -$25 |
| **ì´ ë¹„ìš©** | **$189** | **$25** | **$164 (87% ì ˆê°)** |

---

## âœ… ì™„ë£Œ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ë§ˆì´ê·¸ë ˆì´ì…˜ ì¤€ë¹„
- [x] @env.txtì— Supabase ì„¤ì • ì¶”ê°€
- [x] Supabase í´ë¼ì´ì–¸íŠ¸ ì„¤ì • íŒŒì¼ ìƒì„±
- [x] PostgreSQL ìŠ¤í‚¤ë§ˆ ì‘ì„±
- [x] ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±

### ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰
- [ ] Service Role Key íšë“ ë° ì„¤ì •
- [ ] Supabaseì—ì„œ schema.sql ì‹¤í–‰
- [ ] ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
- [ ] ë°ì´í„° ê²€ì¦

### ì½”ë“œ ì „í™˜
- [ ] Supabase ì„œë¹„ìŠ¤ ë ˆì´ì–´ ì‘ì„±
- [ ] ê¸°ì¡´ Firebase ì½”ë“œì™€ ë¹„êµ í…ŒìŠ¤íŠ¸
- [ ] ì ì§„ì ìœ¼ë¡œ Supabaseë¡œ ì „í™˜
- [ ] ì „ì²´ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸

### ë°°í¬
- [ ] Staging í™˜ê²½ ë°°í¬
- [ ] Production ë°°í¬
- [ ] ëª¨ë‹ˆí„°ë§ ì„¤ì •
- [ ] Firebase ì—°ê²° ì œê±°

---

## ğŸ“ ì°¸ê³  ìë£Œ

- Supabase ê³µì‹ ë¬¸ì„œ: https://supabase.com/docs
- PostgreSQL íŠœí† ë¦¬ì–¼: https://www.postgresqltutorial.com/
- Next.js + Supabase: https://supabase.com/docs/guides/getting-started/quickstarts/nextjs
- RLS ê°€ì´ë“œ: https://supabase.com/docs/guides/auth/row-level-security

---

## ğŸ’¬ ë‹¤ìŒ ë‹¨ê³„

ì§€ê¸ˆ ë°”ë¡œ ì‹œì‘í•˜ë ¤ë©´:

```bash
# 1. Service Role Key ì„¤ì • (.env.localì— ì¶”ê°€)
# 2. schema.sql ì‹¤í–‰ (Supabase SQL Editor)
# 3. ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰
npx ts-node scripts/migrate-firebase-to-supabase.ts
```

ë¬¸ì œê°€ ë°œìƒí•˜ë©´ ì–¸ì œë“ ì§€ ì§ˆë¬¸í•´ì£¼ì„¸ìš”! ğŸš€






